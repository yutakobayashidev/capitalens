"use strict";(self.webpackChunkcapitalens=self.webpackChunkcapitalens||[]).push([[82],{"./src/components/meetings/meetings.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Basic:()=>Basic,default:()=>meetings_stories});var defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),regenerator=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),utils=__webpack_require__("./src/helper/utils.ts"),kuromoji=__webpack_require__("./node_modules/kuromoji/src/kuromoji.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");var _Basic$parameters,_Basic$parameters2,next_link=__webpack_require__("./node_modules/next/link.js"),link_default=__webpack_require__.n(next_link),index_esm=__webpack_require__("./node_modules/react-icons/fa/index.esm.js"),__jsx=react.createElement;function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Meetings(_ref){var meetings=_ref.meetings,user=_ref.user,_useState=(0,react.useState)(!1),isChecked=_useState[0],setIsChecked=_useState[1],_useKuromoji=function useKuromoji(){var _useState=(0,react.useState)(!1),isTokenizerReady=_useState[0],setIsTokenizerReady=_useState[1],tokenizerInstanceRef=(0,react.useRef)();return(0,react.useEffect)((function(){kuromoji.builder({dicPath:"/dict"}).build((function(err,tokenizer){err?console.log(err):(tokenizerInstanceRef.current=tokenizer,setIsTokenizerReady(!0))}))}),[]),{isTokenizerReady,tokenizer:tokenizerInstanceRef.current}}(),isTokenizerReady=_useKuromoji.isTokenizerReady,tokenizer=_useKuromoji.tokenizer,_useState2=(0,react.useState)({}),rubyKids=_useState2[0],setRubyKids=_useState2[1];return(0,react.useEffect)((function(){user&&tokenizer&&setIsChecked(user.kids)}),[user,tokenizer]),(0,react.useEffect)((function(){var generateRubyForAllMeetings=function(){var _ref2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(){var newRubyKids,_iterator,_step,meeting,text,tokens,rubyText;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(isChecked&&tokenizer&&meetings){newRubyKids={},_iterator=_createForOfIteratorHelper(meetings);try{for(_iterator.s();!(_step=_iterator.n()).done;)meeting=_step.value,text=meeting.kids||"",tokens=tokenizer.tokenize(text),rubyText=tokens.map((function(token){var surface=token.surface_form,reading=token.reading;if(!reading)return surface;var hiraReading=(0,utils.Tk)(reading);return surface.split("").some(utils.AF)?"<ruby>".concat(surface,"<rt>").concat(hiraReading,"</rt></ruby>"):surface})).join(""),newRubyKids[meeting.id]=rubyText}catch(err){_iterator.e(err)}finally{_iterator.f()}setRubyKids(newRubyKids)}case 1:case"end":return _context.stop()}}),_callee)})));return function generateRubyForAllMeetings(){return _ref2.apply(this,arguments)}}();generateRubyForAllMeetings()}),[isChecked,tokenizer,meetings]),__jsx("div",null,__jsx("label",{className:"mb-3 flex items-center"},__jsx("input",{type:"checkbox",className:"mr-2",checked:isChecked,disabled:!isTokenizerReady,onChange:function onChange(){return setIsChecked(!isChecked)}}),"子ども向けに説明"),__jsx("div",{className:"grid grid-cols-1 gap-x-4 md:grid-cols-2"},meetings.map((function(meeting){return __jsx(link_default(),{href:"/meetings/".concat(meeting.id),className:"mb-5 rounded-xl border border-gray-200 bg-gray-50 p-6",key:meeting.id},__jsx("h1",{className:"mb-2 flex items-center text-xl font-bold"},meeting.house&&__jsx("span",{className:"".concat("COUNCILLORS"===meeting.house?"bg-indigo-400":"bg-[#EA5433]"," mr-2 rounded px-2 py-1 text-sm font-bold text-white")},"COUNCILLORS"===meeting.house?"参議院":"衆議院"),meeting.meeting_name),__jsx("time",{itemProp:"datePublished",dateTime:meeting.date,className:"flex items-center text-sm text-gray-500"},__jsx(index_esm.qyc,{className:"mr-1 text-gray-400"}),(0,utils.p6)(meeting.date)),meeting.summary&&__jsx("div",{className:"mt-2 line-clamp-4 text-sm text-gray-500"},isChecked&&meeting.kids?__jsx("span",{dangerouslySetInnerHTML:{__html:rubyKids[meeting.id]||""}}):meeting.summary))}))))}Meetings.displayName="Meetings",Meetings.__docgenInfo={description:"",methods:[],displayName:"Meetings",props:{meetings:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  id: string;\n  date: string;\n  house: string | null;\n  kids: string | null;\n  meeting_name: string;\n  summary: string | null;\n}",signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"date",value:{name:"string",required:!0}},{key:"house",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}},{key:"kids",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}},{key:"meeting_name",value:{name:"string",required:!0}},{key:"summary",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}}]}}],raw:"{\n  id: string;\n  date: string;\n  house: string | null;\n  kids: string | null;\n  meeting_name: string;\n  summary: string | null;\n}[]"},description:""},user:{required:!0,tsType:{name:'Session["user"]',raw:'Session["user"]'},description:""}}};try{meetings.displayName="meetings",meetings.__docgenInfo={description:"",displayName:"meetings",props:{meetings:{defaultValue:null,description:"",name:"meetings",required:!0,type:{name:"{ id: string; date: string; house: string | null; kids: string | null; meeting_name: string; summary: string | null; }[]"}},user:{defaultValue:null,description:"",name:"user",required:!0,type:{name:"{ name?: string | null | undefined; email?: string | null | undefined; image?: string | null | undefined; } | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/meetings/meetings.tsx#meetings"]={docgenInfo:meetings.__docgenInfo,name:"meetings",path:"src/components/meetings/meetings.tsx#meetings"})}catch(__react_docgen_typescript_loader_error){}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var Basic={args:{meetings:[{id:"cuid",date:"2023-01-01",house:"COUNCILLORS",kids:"てすと",meeting_name:"テスト委員会",summary:"テスト"}]}};const meetings_stories={component:Meetings,parameters:{layout:"fullscreen"}};Basic.parameters=_objectSpread(_objectSpread({},Basic.parameters),{},{docs:_objectSpread(_objectSpread({},null===(_Basic$parameters=Basic.parameters)||void 0===_Basic$parameters?void 0:_Basic$parameters.docs),{},{source:_objectSpread({originalSource:'{\n  args: {\n    meetings: [{\n      id: "cuid",\n      date: "2023-01-01",\n      house: "COUNCILLORS",\n      kids: "てすと",\n      meeting_name: "テスト委員会",\n      summary: "テスト"\n    }]\n  }\n}'},null===(_Basic$parameters2=Basic.parameters)||void 0===_Basic$parameters2||null===(_Basic$parameters2=_Basic$parameters2.docs)||void 0===_Basic$parameters2?void 0:_Basic$parameters2.source)})})},"./src/helper/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AF:()=>isKanji,Tk:()=>kanaToHira,ci:()=>getHostFromURL,gO:()=>getFaviconSrcFromHostname,p6:()=>formatDate});__webpack_require__("./node_modules/dayjs/locale/ja.js");var dayjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/dayjs/dayjs.min.js"),dayjs__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(dayjs__WEBPACK_IMPORTED_MODULE_1__),dayjs_plugin_relativeTime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/dayjs/plugin/relativeTime.js"),dayjs_plugin_relativeTime__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(dayjs_plugin_relativeTime__WEBPACK_IMPORTED_MODULE_2__);function getFaviconSrcFromHostname(hostname){return"https://www.google.com/s2/favicons?sz=128&domain=".concat(hostname)}function getHostFromURL(url){return new URL(url).hostname}function formatDate(dateText){var format=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD",date=dayjs__WEBPACK_IMPORTED_MODULE_1___default()(dateText);return Math.abs(date.diff(Date.now(),"month"))<6?date.fromNow():date.format(format)}dayjs__WEBPACK_IMPORTED_MODULE_1___default().locale("ja"),dayjs__WEBPACK_IMPORTED_MODULE_1___default().extend(dayjs_plugin_relativeTime__WEBPACK_IMPORTED_MODULE_2___default());var kanaToHira=function kanaToHira(str){return str.replace(/[\u30a1-\u30f6]/g,(function(match){return String.fromCharCode(match.charCodeAt(0)-96)}))},isKanji=function isKanji(ch){var unicode=ch.charCodeAt(0);return unicode>=19968&&unicode<=40879}}}]);